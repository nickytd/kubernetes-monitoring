apiVersion: v1
kind: ConfigMap
metadata:
  name: logs-per-namespace-dashboard
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  logs-per-namespace-dashboard.json: |-
    {
      "annotations":{
         "list":[
            {
               "builtIn":1,
               "datasource":"-- Grafana --",
               "enable":true,
               "hide":true,
               "iconColor":"rgba(0, 211, 255, 1)",
               "name":"Annotations & Alerts",
               "type":"dashboard"
            }
         ]
      },
      "description":"Shows container logs per namespace",
      "editable":true,
      "gnetId":null,
      "graphTooltip":0,
      "iteration":1616703953036,
      "links":[
         {
            "icon":"external link",
            "includeVars":false,
            "keepTime":false,
            "tags":[
               
            ],
            "targetBlank":true,
            "title":"Kibana Container Logs Dashboard",
            "tooltip":"Kibana Container Logs Dashboard",
            "type":"link",
            "url":"https://kibana/app/kibana?security_tenant=global#/dashboard/9419fb30-547c-11ea-ac0b-5b9ac52105c7?_g=(refreshInterval%3A(pause%3A!t%2Cvalue%3A0)%2Ctime%3A(from%3Anow-15m,to%3Anow))"
         }
      ],
      "panels":[
         {
            "cacheTimeout":null,
            "datasource":"elk-containers",
            "description":"",
            "fieldConfig":{
               "defaults":{
                  "custom":{
                     "align":null,
                     "filterable":false
                  },
                  "decimals":0,
                  "links":[
                     {
                        "title":"namespace logs",
                        "url":"/d/k8s-logs-per-namespace-v2/logs-per-namespace?var-namespace=${__data.fields[0].text}&${__url_time_range}"
                     }
                  ],
                  "mappings":[
                     
                  ],
                  "min":0,
                  "thresholds":{
                     "mode":"absolute",
                     "steps":[
                        {
                           "color":"green",
                           "value":null
                        },
                        {
                           "color":"red",
                           "value":80
                        }
                     ]
                  },
                  "unit":"none"
               },
               "overrides":[
                  
               ]
            },
            "gridPos":{
               "h":8,
               "w":6,
               "x":0,
               "y":0
            },
            "id":4,
            "interval":null,
            "links":[
               
            ],
            "maxDataPoints":1,
            "options":{
               "frameIndex":1,
               "showHeader":false,
               "sortBy":[
                  {
                     "desc":true,
                     "displayName":"Count"
                  }
               ]
            },
            "pluginVersion":"7.4.3",
            "targets":[
               {
                  "alias":"",
                  "bucketAggs":[
                     {
                        "field":"kubernetes.namespace",
                        "id":"2",
                        "settings":{
                           "min_doc_count":0,
                           "order":"desc",
                           "orderBy":"_count",
                           "size":"0"
                        },
                        "type":"terms"
                     }
                  ],
                  "metrics":[
                     {
                        "field":"select field",
                        "id":"1",
                        "type":"count"
                     }
                  ],
                  "query":"",
                  "refId":"A",
                  "timeField":"@timestamp"
               }
            ],
            "timeFrom":null,
            "timeShift":null,
            "title":"Namespaces",
            "type":"table"
         },
         {
            "datasource":"elk-containers",
            "description":"",
            "fieldConfig":{
               "defaults":{
                  "custom":{
                     "align":null,
                     "displayMode":"auto",
                     "filterable":false
                  },
                  "decimals":0,
                  "displayName":"Pods",
                  "links":[
                     {
                        "title":"pod logs",
                        "url":"/d/k8s-logs-per-namespace-v2/logs-per-namespace?var-pod=${__data.fields[0].text}&${__url_time_range}"
                     }
                  ],
                  "mappings":[
                     
                  ],
                  "min":0,
                  "noValue":"0",
                  "thresholds":{
                     "mode":"absolute",
                     "steps":[
                        {
                           "color":"green",
                           "value":null
                        },
                        {
                           "color":"red",
                           "value":80
                        }
                     ]
                  },
                  "unit":"none"
               },
               "overrides":[
                  
               ]
            },
            "gridPos":{
               "h":8,
               "w":10,
               "x":6,
               "y":0
            },
            "id":8,
            "options":{
               "showHeader":false,
               "sortBy":[
                  {
                     "desc":false,
                     "displayName":"kubernetes.pod.name.keyword"
                  }
               ]
            },
            "pluginVersion":"7.4.3",
            "targets":[
               {
                  "bucketAggs":[
                     {
                        "field":"kubernetes.pod.name",
                        "id":"2",
                        "settings":{
                           "min_doc_count":1,
                           "order":"desc",
                           "orderBy":"_count",
                           "size":"0"
                        },
                        "type":"terms"
                     }
                  ],
                  "metrics":[
                     {
                        "field":"select field",
                        "id":"1",
                        "type":"count"
                     }
                  ],
                  "query":"kubernetes.namespace:$namespace",
                  "refId":"A",
                  "timeField":"@timestamp"
               }
            ],
            "timeFrom":null,
            "timeShift":null,
            "title":"Logs per Pod in $namespace",
            "transformations":[
               
            ],
            "type":"table"
         },
         {
            "aliasColors":{
               
            },
            "bars":false,
            "dashLength":10,
            "dashes":false,
            "datasource":"elk-containers",
            "decimals":0,
            "description":"",
            "fieldConfig":{
               "defaults":{
                  "custom":{
                     
                  },
                  "links":[
                     
                  ]
               },
               "overrides":[
                  
               ]
            },
            "fill":1,
            "fillGradient":0,
            "gridPos":{
               "h":8,
               "w":8,
               "x":16,
               "y":0
            },
            "hiddenSeries":false,
            "id":2,
            "legend":{
               "alignAsTable":false,
               "avg":false,
               "current":false,
               "hideEmpty":true,
               "hideZero":true,
               "max":false,
               "min":false,
               "rightSide":false,
               "show":true,
               "total":true,
               "values":true
            },
            "lines":true,
            "linewidth":1,
            "nullPointMode":"null as zero",
            "options":{
               "alertThreshold":true
            },
            "percentage":false,
            "pluginVersion":"7.4.3",
            "pointradius":2,
            "points":false,
            "renderer":"flot",
            "repeat":null,
            "seriesOverrides":[
               {
                  
               }
            ],
            "spaceLength":10,
            "stack":false,
            "steppedLine":false,
            "targets":[
               {
                  "bucketAggs":[
                     {
                        "fake":true,
                        "field":"kubernetes.namespace",
                        "id":"3",
                        "settings":{
                           "min_doc_count":0,
                           "order":"desc",
                           "orderBy":"_count",
                           "size":"10"
                        },
                        "type":"terms"
                     },
                     {
                        "field":"@timestamp",
                        "id":"2",
                        "settings":{
                           "interval":"auto",
                           "min_doc_count":0,
                           "offset":"",
                           "trimEdges":null
                        },
                        "type":"date_histogram"
                     }
                  ],
                  "hide":false,
                  "metrics":[
                     {
                        "field":"select field",
                        "id":"1",
                        "type":"count"
                     }
                  ],
                  "query":"",
                  "refId":"A",
                  "timeField":"@timestamp"
               }
            ],
            "thresholds":[
               
            ],
            "timeFrom":null,
            "timeRegions":[
               
            ],
            "timeShift":null,
            "title":"Logs per Namespace",
            "tooltip":{
               "shared":true,
               "sort":0,
               "value_type":"individual"
            },
            "type":"graph",
            "xaxis":{
               "buckets":null,
               "mode":"time",
               "name":null,
               "show":true,
               "values":[
                  
               ]
            },
            "yaxes":[
               {
                  "decimals":0,
                  "format":"none",
                  "label":"",
                  "logBase":1,
                  "max":null,
                  "min":"0",
                  "show":true
               },
               {
                  "decimals":-3,
                  "format":"short",
                  "label":"",
                  "logBase":1,
                  "max":null,
                  "min":null,
                  "show":false
               }
            ],
            "yaxis":{
               "align":false,
               "alignLevel":null
            }
         },
         {
            "datasource":"elk-containers",
            "fieldConfig":{
               "defaults":{
                  "custom":{
                     
                  }
               },
               "overrides":[
                  
               ]
            },
            "gridPos":{
               "h":10,
               "w":24,
               "x":0,
               "y":8
            },
            "id":6,
            "links":[
               {
                  "targetBlank":true,
                  "title":"Kibana Logs",
                  "url":"https://kibana/app/kibana#/discover?_g=()&_a=(columns:!(message),index:containers,interval:auto,query:(language:kuery,query:''),sort:!(!('@timestamp',desc)))"
               }
            ],
            "options":{
               "showLabels":false,
               "showTime":true,
               "sortOrder":"Descending",
               "wrapLogMessage":true
            },
            "targets":[
               {
                  "bucketAggs":[
                     {
                        "field":"@timestamp",
                        "id":"2",
                        "settings":{
                           "interval":"auto",
                           "min_doc_count":0,
                           "trimEdges":0
                        },
                        "type":"date_histogram"
                     }
                  ],
                  "metrics":[
                     {
                        "field":"select field",
                        "id":"3",
                        "meta":{
                           
                        },
                        "settings":{
                           
                        },
                        "type":"logs"
                     }
                  ],
                  "query":"kubernetes.namespace:$namespace AND kubernetes.pod.name:$pod",
                  "refId":"A",
                  "timeField":"@timestamp"
               }
            ],
            "timeFrom":null,
            "timeShift":null,
            "title":"Logs in ${namespace} namespace / ${pod} pod",
            "type":"logs"
         }
      ],
      "refresh":false,
      "schemaVersion":27,
      "style":"dark",
      "tags":[
         "elk"
      ],
      "templating":{
         "list":[
            {
               "allValue":"",
               "current":{
                  "selected":false,
                  "text":"All",
                  "value":"$__all"
               },
               "datasource":"elk-containers",
               "definition":"{\"find\": \"terms\", \"field\": \"kubernetes.namespace\"}",
               "description":null,
               "error":null,
               "hide":0,
               "includeAll":true,
               "label":"namespace",
               "multi":false,
               "name":"namespace",
               "options":[
                  
               ],
               "query":"{\"find\": \"terms\", \"field\": \"kubernetes.namespace\"}",
               "refresh":1,
               "regex":"",
               "skipUrlSync":false,
               "sort":1,
               "tagValuesQuery":"",
               "tags":[
                  
               ],
               "tagsQuery":"",
               "type":"query",
               "useTags":false
            },
            {
               "allValue":"",
               "current":{
                  "selected":false,
                  "text":"All",
                  "value":"$__all"
               },
               "datasource":"elk-containers",
               "definition":"{\"find\": \"terms\", \"field\": \"kubernetes.pod.name\", \"query\": \"kubernetes.namespace:$namespace\"}",
               "description":null,
               "error":null,
               "hide":0,
               "includeAll":true,
               "label":"pod",
               "multi":false,
               "name":"pod",
               "options":[
                  
               ],
               "query":"{\"find\": \"terms\", \"field\": \"kubernetes.pod.name\", \"query\": \"kubernetes.namespace:$namespace\"}",
               "refresh":1,
               "regex":"",
               "skipUrlSync":false,
               "sort":0,
               "tagValuesQuery":"",
               "tags":[
                  
               ],
               "tagsQuery":"",
               "type":"query",
               "useTags":false
            }
         ]
      },
      "time":{
         "from":"now-15m",
         "to":"now"
      },
      "timepicker":{
         "nowDelay":"",
         "refresh_intervals":[
            "10s",
            "30s",
            "1m",
            "5m",
            "15m",
            "30m",
            "1h",
            "2h",
            "1d"
         ]
      },
      "timezone":"",
      "title":"Logs per Namespace",
      "uid":"k8s-logs-per-namespace-v2",
      "version":1
    }